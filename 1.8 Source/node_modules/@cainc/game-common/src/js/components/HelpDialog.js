export default class HelpDialog {
    constructor(gameState, onComplete, helpScreens, clickSound) {
        this._onComplete = onComplete;
        this._gameState = gameState;
        this._helpScreens = helpScreens;
        this._activeScreen = 0;
        this._clickSound = clickSound;

        this._screenAssets = [];

        this._background = gameState.add.image(0, 0, 'help_background');
        this._background.inputEnabled = true;
        this._background.input.useHandCursor = true;
        this._background.events.onInputDown.add(this.onClick, this);

        this.showScreen();
    }

    onClick() {
        ++this._activeScreen;
        if (this._activeScreen >= this._helpScreens.length) {
            this.removeCurrentScreen();
            this._gameState.world.remove(this._background, true);
            this._onComplete();
        } else {
            this.removeCurrentScreen();
            this.showScreen();
        }
        if (this._clickSound) {
            this._clickSound.play();
        }
    }

    removeCurrentScreen() {
        this._screenAssets.forEach((asset) => {
            this._gameState.world.remove(asset, true);
        });
    }

    showScreen() {
        const screen = this._helpScreens[this._activeScreen];
        _.forEach(screen, (dataObj) => {
            if (dataObj.type === 'image') {
                this._screenAssets.push(this._gameState.add.image(dataObj.x, dataObj.y, dataObj.assetName));
            } else if (dataObj.type === 'text') {
                this._screenAssets.push(this._gameState.add.text(dataObj.x, dataObj.y, dataObj.text, dataObj.style));
            }
        });
    }
}



//////////////////
// WEBPACK FOOTER
// ./node_modules/@cainc/game-common/src/js/components/HelpDialog.js
// module id = 129
// module chunks = 0